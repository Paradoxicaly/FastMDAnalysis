.. currentmodule:: FastMDAnalysis.analysis.ss

Secondary Structure
===================

The :class:`SSAnalysis` module assigns secondary structure using DSSP and
produces the categorical heatmaps described in Section 3.6 of the manuscript.
It complements RMSD/RMSF diagnostics by exposing when helices, sheets, and loops
form or dissolve during a trajectory.

Theory
------

FastMDAnalysis delegates to :func:`mdtraj.compute_dssp`, which wraps the DSSP
algorithm. Each residue receives one of the standard eight-letter codes
(``H``, ``B``, ``E``, ``G``, ``I``, ``T``, ``S``, ``C``) based on local hydrogen
bond patterns and backbone geometry.

Implementation Highlights
-------------------------

- Persists assignments to ``ss_output/ss.dat`` as comma-separated codes per
  frame for easy grepping in scripts.
- Writes ``ss_output/ss_README.md`` summarising the DSSP alphabet so users can
  interpret the heatmap offline.
- :meth:`SSAnalysis.plot` converts the categorical matrix to a discrete colour
  map with labelled tick marks, ensuring readability in grayscale prints.

Usage
-----

**API**

.. code-block:: python

   from FastMDAnalysis import FastMDAnalysis

   fastmda = FastMDAnalysis("traj.dcd", "top.pdb")
   ss = fastmda.ss()
   ss_results = ss.run()
   ss.plot(title="Secondary Structure Timeline")

**CLI**

.. code-block:: bash

   fastmda ss -traj traj.dcd -top top.pdb -o analysis/ss

Outputs
-------

- ``ss_output/ss.dat`` — comma-delimited DSSP codes per frame.
- ``ss_output/ss.png`` — discrete heatmap generated by :meth:`SSAnalysis.plot`.
- ``ss_output/ss_README.md`` — legend explaining each DSSP code.
- ``ss_output/ss.log`` — log file capturing run parameters.

Interpretation Tips
-------------------

- Loss of sheet (``E``) or helix (``H``) populations can explain spikes in
  :doc:`rmsd`; conversely, transient turns (``T``) often precede helix
  formation.
- Combine with :doc:`hbonds` to confirm whether structural transitions are
  stabilised by new hydrogen bond networks.

Troubleshooting
---------------

- DSSP requires a complete protein topology with backbone atoms; ensure the
  topology file includes hydrogens or use MDTraj to add them if DSSP raises
  topology errors.
- ``SSAnalysis.plot`` expects data shaped ``(n_frames, n_residues)``; if a
  truncated trajectory is supplied, re-run :meth:`SSAnalysis.run` to refresh the
  cache before plotting again.
